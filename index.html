<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>M&M-COMMUNITY - FINAL TEST</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { background:#000; color:#fff; font-family:sans-serif; margin:0; display:flex; flex-direction:column; align-items:center; height:100vh; overflow:hidden; }
        .dashboard-header { width:100%; padding:20px; display:flex; justify-content:flex-start; }
        .logo-ring { width:100px; height:100px; border:3px solid #fff; border-radius:50%; background:#003d8f; display:flex; align-items:center; justify-content:center; cursor:pointer; font-weight:900; }
        .info-section { width:85%; height:25vh; border:2px solid #003d8f; margin:20px 0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; width:95%; border:2px solid #00ff00; padding:15px; }
        .box { display:flex; border:1px solid #003d8f; height:50px; background:#000; }
        .num { width:40px; background:#003d8f; display:flex; align-items:center; justify-content:center; font-weight:bold; }
        .text { flex:1; padding:5px; font-size:0.65rem; display:flex; align-items:center; cursor:pointer; text-transform:uppercase; }
        #page-skelett { display:none; width:100%; flex-direction:column; align-items:center; }
        .ebene4-header-red { width:100%; background:red; color:#fff; padding:10px; text-align:center; font-weight:bold; display:none; }
        .tafel-layout { display:flex; width:90%; align-items:center; justify-content:center; position:relative; height:20vh; margin:20px 0; }
        .buttons-links { position:absolute; left:0; display:flex; flex-direction:column; gap:10px; }
        .oval-side { width:40px; height:20px; border:1px solid #fff; border-radius:10px; cursor:pointer; }
        #chat-area, #drawer-ebene4 { width:90%; display:none; flex-direction:column; }
        .chat-msgs { height:35vh; border:1px solid #003d8f; overflow-y:auto; margin-bottom:10px; padding:10px; background:#050505; }
        .video-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
        .video-slot { aspect-ratio:16/9; background:#111; border:1px solid #003d8f; display:flex; align-items:center; justify-content:center; font-size:0.6rem; overflow:hidden; }
        .bottom-nav { position:fixed; bottom:0; width:100%; display:flex; justify-content:space-between; padding:15px; background:#000; border-top:1px solid #333; }
        .nav-btn { background:#ffd700; color:#000; border:none; padding:10px 20px; font-weight:bold; cursor:pointer; }
    </style>
</head>
<body>

    <div id="dashboard">
        <div class="dashboard-header"><div class="logo-ring">M&M</div></div>
        <div class="info-section"><h1>DAS WAS & WARUM</h1><h2 style="color:#003d8f">DIE STILLE MILLION</h2></div>
        <div class="grid" id="main-grid"></div>
    </div>

    <div id="page-skelett">
        <div class="ebene4-header-red" id="ebene4-title-red">SEKTOR LIVE</div>
        <div class="tafel-layout">
            <div class="buttons-links">
                <div class="oval-side" style="background:#000" onclick="showDashboard()"></div>
                <div class="oval-side" style="background:#00ff00" onclick="setEbene(2)"></div>
                <div class="oval-side" style="background:#0000ff" onclick="setEbene(3)"></div>
                <div class="oval-side" style="background:#ff0000" onclick="setEbene(4)"></div>
            </div>
            <div class="info-section-ebene" style="border:2px solid #003d8f; width:85%; height:100%; display:flex; align-items:center; justify-content:center;">
                <h1 id="info-titel" style="font-size:1.5rem; text-align:center;"></h1>
            </div>
        </div>
        <div id="chat-area">
            <div class="chat-msgs" id="chat-box"></div>
            <input type="text" id="chat-input" placeholder="Schreiben..." style="width:100%; padding:15px; background:#000; color:#fff; border:1px solid #003d8f; outline:none;" onkeypress="if(event.key==='Enter') sendMsg()">
        </div>
        <div id="drawer-ebene4">
            <div class="video-grid">
                <div class="video-slot" id="v-slot-1">DU</div>
                <div class="video-slot" id="v-slot-2">PARTNER</div>
                <div class="video-slot">...</div>
                <div class="video-slot">...</div>
            </div>
            <button onclick="startVideo()" style="width:100%; padding:20px; background:#00ff00; font-weight:bold; margin-top:10px; cursor:pointer; border:none;">KAMERA AKTIVIEREN</button>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn" onclick="showDashboard()">DASHBOARD</button>
        <button class="nav-btn" onclick="nextEbene()">WEITER</button>
    </div>

<script>
    const ably = new Ably.Realtime('8_Z6_g.x8999g:pYlD6QyG-A_v9H_A');
    const myId = "User-" + Math.random().toString(36).substring(7);
    const themen = ["Recht auf Gefühls Forderung", "Wie werde ich Mensch", "Glaube an Friede", "Programm für Bürgerliche Rechte", "Moralische Pflicht und Verantwortung", "Menschlichkeit Wiederherstellung", "Kinderschutz-Pflicht-Elternrechte", "Wahre Richtung und Kunst", "LGBTQ und Kirche", "Trend and Tradition", "Religionsbekenntnis oder Selbstwahl", "Gesundheitswesen und Verhalten", "Arbeitswelt und Du", "Mobbing am Arbeitsplatz", "Jugendsprecher", "Ratgeber für Pensionisten", "Sozialgefallen und Widerkehr", "Nachbarschaft und Gemeinschaft", "Mensch und Technik", "Die Brücke"];
    let ebene = 1, currentSektor = 0, channel = null;

    const g = document.getElementById('main-grid');
    themen.forEach((t, i) => {
        g.innerHTML += `<div class="box"><div class="num">${i+1}</div><div class="text" onclick="openSektor(${i},'${t}')">${t}</div></div>`;
    });

    function openSektor(id, t) {
        currentSektor = id;
        document.getElementById('info-titel').innerText = t;
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('page-skelett').style.display = 'flex';
        setEbene(2);
        if(channel) channel.unsubscribe();
        channel = ably.channels.get('mm-sektor-' + id);
        channel.subscribe('message', m => {
            if(m.data.sender !== myId) {
                document.getElementById('chat-box').innerHTML += `<div style="color:#ffd700; margin-bottom:10px;"><strong>Partner:</strong> ${m.data.text}</div>`;
                document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
            }
        });
    }

    function sendMsg() {
        const inp = document.getElementById('chat-input');
        if(!inp.value || !channel) return;
        channel.publish('message', {text: inp.value, sender: myId});
        document.getElementById('chat-box').innerHTML += `<div style="margin-bottom:10px;"><strong>Du:</strong> ${inp.value}</div>`;
        inp.value = "";
        document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
    }

    function setEbene(n) {
        ebene = n;
        document.getElementById('chat-area').style.display = (n === 3) ? 'flex' : 'none';
        document.getElementById('drawer-ebene4').style.display = (n === 4) ? 'flex' : 'none';
        document.getElementById('ebene4-title-red').style.display = (n === 4) ? 'block' : 'none';
    }

    function nextEbene() { if(ebene < 4) setEbene(ebene + 1); }
    function showDashboard() { document.getElementById('dashboard').style.display = 'flex'; document.getElementById('page-skelett').style.display = 'none'; ebene = 1; }

    async function startVideo() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
            const v = document.createElement('video');
            v.srcObject = stream; v.autoplay = true; v.muted = true; v.style.width="100%"; v.style.height="100%"; v.style.objectFit="cover";
            const slot = document.getElementById('v-slot-1');
            slot.innerHTML = ""; slot.appendChild(v);
        } catch(e) { alert("Kamera-Fehler! Bitte Zugriff erlauben."); }
    }
</script>
</body>
</html>
