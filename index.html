<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>M&M-COMMUNITY - LIVE</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        /* Alles kompakt & scharf */
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        @keyframes signalBlink { 0% { box-shadow: 0 0 5px #fff; opacity: 0.8; } 50% { box-shadow: 0 0 25px #fff, 0 0 35px #003d8f; opacity: 1; transform: scale(1.05); } 100% { box-shadow: 0 0 5px #fff; opacity: 0.8; } }
        .signal-aktiv { animation: signalBlink 1.0s infinite ease-in-out !important; border: 2px solid #fff !important; cursor: pointer; }
        .dashboard-header { width: 100%; display: flex; justify-content: flex-start; padding: 10px 2%; z-index: 20; }
        .logo-ring { width: 90px; height: 90px; border: 3px solid #fff; background-color: #003d8f; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .info-section { width: 90%; height: 20vh; border: 2px solid #003d8f; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #000; margin-top: 10px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 95%; margin-top: 20px; border: 2px solid #00ff00; padding: 10px; }
        .box { display: flex; border: 1px solid #003d8f; background: #000; min-height: 50px; }
        .num { width: 30px; display: flex; align-items: center; justify-content: center; background: #003d8f; font-weight: bold; font-size: 0.8rem; }
        .text { padding: 5px; font-size: 0.65rem; cursor: pointer; flex-grow: 1; display: flex; align-items: center; text-transform: uppercase; }
        #chat-area { width: 95%; height: 50vh; display: none; flex-direction: column; margin-top: 20px; }
        .chat-msgs { flex: 1; overflow-y: auto; padding: 10px; border: 1px solid #333; background: #050505; }
        .chat-input-row { display: flex; border: 1px solid #003d8f; margin-top: 5px; }
        .num-neutral { background: #003d8f; }
        .num-gelesen { background: #ffd700; color: #000; }
        .num-fertig { background: #00ff00; color: #000; }
        .bottom-nav { display: flex; justify-content: space-between; width: 100%; padding: 10px; position: fixed; bottom: 0; background: #000; border-top: 1px solid #333; }
        .nav-btn { background: #ffd700; color: #000; border: none; padding: 8px 15px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="dashboard" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <div class="dashboard-header">
            <div class="logo-ring" ondblclick="adminUnlock()"><small>M&M</small></div>
        </div>
        <div class="info-section">
            <h1 style="margin:0">M&M COMMUNITY</h1>
            <p>Sektoren-System aktiv</p>
        </div>
        <div class="grid" id="main-grid"></div>
        <div style="display:flex; gap:10px; width:95%; margin-top:10px;">
            <div class="box" style="flex:1; border-color:#8b00ff; cursor:pointer;" onclick="verifizieren()">
                <div class="num" style="background:#8b00ff">V</div>
                <div class="text" style="color:#ffd700">Verifizierter Status</div>
            </div>
        </div>
    </div>

    <div id="page-skelett" style="display: none; width: 100%; flex-direction: column; align-items: center;">
        <h2 id="info-titel"></h2>
        <div id="chat-area">
            <div class="chat-msgs" id="chat-box"></div>
            <div class="chat-input-row">
                <input type="text" id="chat-input" placeholder="Nachricht..." style="flex:1; background:transparent; border:none; color:#fff; padding:10px; outline:none;" onkeypress="if(event.key==='Enter') registriereSenden()">
                <button onclick="registriereSenden()" style="background:#003d8f; color:#fff; border:none; padding:10px;">SENDEN</button>
            </div>
        </div>
        <p id="main-text" style="padding:20px; text-align:center; color:#ccc;"></p>
    </div>

    <div class="bottom-nav">
        <button id="btn-back" class="nav-btn" style="visibility: hidden;" onclick="showDashboard()">← Dashboard</button>
    </div>

<script>
    // --- SETUP ---
    const ably = new Ably.Realtime('8_Z6_g.x8999g:pYlD6QyG-A_v9H_A');
    const meinTabId = Math.random().toString(36).substring(7);
    let userBackstage = { isVerifiziert: false };
    let tId = 0, aktuellerChannel = null;
    const themen = ["Recht auf Gefühl", "Wie werde ich Mensch", "Glaube an Friede", "Bürgerliche Rechte", "Moralische Pflicht", "Menschlichkeit", "Kinderschutz", "Wahre Richtung", "LGBTQ und Kirche", "Trend and Tradition", "Religionsbekenntnis", "Gesundheitswesen", "Arbeitswelt", "Mobbing", "Jugendsprecher", "Ratgeber", "Sozialgefallen", "Nachbarschaft", "Mensch und Technik", "Die Brücke"];
    let geleseneThemen = new Set();

    // --- GRID BAUEN ---
    const grid = document.getElementById('main-grid');
    themen.forEach((t, i) => {
        grid.innerHTML += `<div class="box" id="box-${i}"><div class="num" id="num-${i}">${i+1}</div><div class="text" onclick="showInfo('${t}', ${i})">${t}</div></div>`;
    });

    function verifizieren() {
        userBackstage.isVerifiziert = true;
        alert("Status: Verifiziert! Live-Chat freigeschaltet.");
    }

    function showInfo(t, id) {
        tId = id;
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('page-skelett').style.display = 'flex';
        document.getElementById('info-titel').innerText = t;
        document.getElementById('btn-back').style.visibility = 'visible';

        if(userBackstage.isVerifiziert) {
            document.getElementById('chat-area').style.display = 'flex';
            document.getElementById('main-text').style.display = 'none';
            verbindeMitSektorChat(id);
        } else {
            document.getElementById('chat-area').style.display = 'none';
            document.getElementById('main-text').style.display = 'block';
            document.getElementById('main-text').innerText = "Bitte verifizieren, um am Dialog teilzunehmen.";
        }
        geleseneThemen.add(id);
        updateColors();
    }

    function verbindeMitSektorChat(sektorId) {
        if (aktuellerChannel) { aktuellerChannel.unsubscribe(); }
        aktuellerChannel = ably.channels.get('mm-sektor-' + sektorId);
        document.getElementById('chat-box').innerHTML = `<i>Verbunden mit Sektor ${sektorId+1}...</i>`;
        
        aktuellerChannel.subscribe('message', (msg) => {
            if (msg.data.senderId !== meinTabId) {
                const cb = document.getElementById('chat-box');
                cb.innerHTML += `<div><b style="color:#ffd700">Partner:</b> ${msg.data.text}</div>`;
                cb.scrollTop = cb.scrollHeight;
            }
        });
    }

    function registriereSenden() {
        const input = document.getElementById('chat-input');
        if(!input.value || !aktuellerChannel) return;
        aktuellerChannel.publish('message', { text: input.value, senderId: meinTabId });
        document.getElementById('chat-box').innerHTML += `<div><b>Du:</b> ${input.value}</div>`;
        input.value = "";
        document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
    }

    function showDashboard() {
        document.getElementById('page-skelett').style.display = 'none';
        document.getElementById('dashboard').style.display = 'flex';
        updateColors();
    }

    function updateColors() {
        themen.forEach((_, i) => {
            const n = document.getElementById(`num-${i}`);
            if(geleseneThemen.has(i)) n.className = "num num-gelesen";
        });
    }

    function adminUnlock() {
        userBackstage.isVerifiziert = true;
        themen.forEach((_, i) => geleseneThemen.add(i));
        updateColors();
        alert("ADMIN MODUS AKTIV");
    }
</script>
</body>
</html>
