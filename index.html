<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>M&M-COMMUNITY - Admin Modus</title>
    <style>
        /* BASIS-LAYOUT */
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }

        /* ANIMATIONEN */
        @keyframes kenburns { 0% { transform: scale(1) translate(0, 0); } 50% { transform: scale(1.15) translate(-1%, -1%); } 100% { transform: scale(1) translate(0, 0); } }
        @keyframes fadeEffect { 0% { opacity: 0; } 15% { opacity: 0.4; } 85% { opacity: 0.4; } 100% { opacity: 0; } }
        @keyframes signalBlink { 0% { box-shadow: 0 0 5px #fff; opacity: 0.8; } 50% { box-shadow: 0 0 25px #fff, 0 0 35px #003d8f; opacity: 1; transform: scale(1.05); } 100% { box-shadow: 0 0 5px #fff; opacity: 0.8; } }
        .elite-aktiv { background-color: #ffd700 !important; box-shadow: 0 0 10px #ffd700; border: 2px solid #fff !important; cursor: pointer; }
        @keyframes pulsieren { 0% { opacity: 0.5; } 50% { opacity: 1; text-shadow: 0 0 10px #ffd700; } 100% { opacity: 0.5; } }
        .pulsieren { animation: pulsieren 2s infinite ease-in-out; font-weight: bold; }
        .signal-aktiv { animation: signalBlink 1.0s infinite ease-in-out !important; border: 2px solid #fff !important; cursor: pointer; }

        /* LILA BALKEN */
        .lila-registrierung-leiste { width: 100%; height: 80px; background: #8b00ff; border-top: 2px solid #fff; border-bottom: 2px solid #fff; display: flex; align-items: center; justify-content: center; margin-top: 20px; box-shadow: 0 0 20px #8b00ff; }
        .registrierung-text { color: #fff; font-size: 2.2rem; font-weight: 900; letter-spacing: 15px; text-transform: uppercase; }

        /* HEADER & TAFEL */
        .dashboard-header { width: 100%; position: absolute; top: 3%; display: flex; justify-content: flex-start; padding: 0 2%; box-sizing: border-box; z-index: 20; }
        .logo-ring { width: 110px; height: 110px; border: 3px solid #fff; background-color: #003d8f; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .logo-mm { font-size: 2rem; font-weight: 900; line-height: 0.8; }
        .logo-community { font-size: 0.6rem; letter-spacing: 1.5px; text-transform: uppercase; font-weight: bold; }
        .info-section { width: 80%; height: 26vh; border: 2px solid #003d8f; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #000; position: relative; overflow: hidden; margin-top: 2vh; }
        
        .tafel-layout { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            width: 100%; 
            position: relative; 
            margin-top: 1vh; 
            height: 26vh; 
            min-height: 26vh; 
            flex-shrink: 0; 
        }

        .info-section-ebene { width: 90% !important; height: 100%; border: 2px solid #003d8f; background-color: #000; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }

        /* BUTTONS */
        .buttons-links { position: absolute; left: 1.5%; display: flex; flex-direction: column; gap: 15px; z-index: 20; }
        .buttons-rechts { position: absolute; right: 1.5%; display: flex; flex-direction: column; gap: 15px; z-index: 20; }
        .oval-side { width: 45px; height: 22px; border-radius: 12px; border: 1px solid #fff; opacity: 0.8; transition: all 0.3s; }
        .ov-schwarz { background: #000; border: 1.5px solid #003d8f; }
        .ov-grun { background: #00ff00; }
        .ov-blau { background: #0000ff; }
        .ov-rot { background: #ff0000; }
        .ov-pink { background: #ff00ff; }
        .ov-gelb { background: #ffff00; }

        /* DASHBOARD GRID */
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); grid-auto-flow: column; gap: 10px; width: 95%; max-width: 1450px; margin-top: 30px; border: 3px solid #00ff00; padding: 15px; border-radius: 10px; }
        .box, .fundament-box { display: flex; border: 2px solid #003d8f; background-color: #000; min-height: 58px; position: relative; overflow: hidden; }
        .num { width: 38px; display: flex; align-items: center; justify-content: center; background-color: #003d8f; font-weight: bold; flex-shrink: 0; font-size: 0.85rem; }
        .text { padding: 4px 8px; text-transform: uppercase; font-size: 0.6rem; display: flex; align-items: center; cursor: pointer; flex-grow: 1; font-weight: 600; }

        /* EBENE 3: Chat-Bereich */
        #chat-area {
            width: 90% !important;
            height: 45vh; 
            flex-grow: 1; 
            display: none; 
            flex-direction: column; 
            margin: 0 auto 70px auto; 
            position: relative; 
            overflow: hidden;
            border: none !important;
            mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 100%);
        }

        .chat-msgs { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-end; 
            padding: 10px 0; 
            color: #fff; 
            font-size: 1.1rem; 
            overflow-y: auto; 
            border: none !important; 
            scrollbar-width: none; 
        }

        .chat-msgs::-webkit-scrollbar { width: 0px; background: transparent; }

        .chat-input-row { 
            display: flex; 
            border: 1px solid #003d8f; 
            background: rgba(0, 0, 0, 0.9); 
            padding: 5px; 
            border-radius: 4px; 
            flex-shrink: 0;
            margin-top: 5px;
            z-index: 10;
        }

       /* KORRIGIERTE BASIS FÜR MEHR PLATZ */
body { 
    background-color: #000; 
    color: #fff; 
    font-family: 'Segoe UI', Arial, sans-serif; 
    margin: 0; 
    padding: 0; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    /* Änderungen hier: */
    min-height: 100vh; 
    overflow-y: auto; 
}

/* EBENE 4: JETZT MIT UNENDLICHEM PLATZ NACH UNTEN */
#drawer-ebene4 { 
    overflow: visible; /* Sperre entfernt */
    padding-right: 5px; 
    width: 90%; 
    display: none; 
    flex-direction: column; 
    padding-bottom: 150px; /* Platzhalter für die freien Zonen */
}

/* PAGE SKELETT ANPASSUNG */
#page-skelett { 
    display: none; 
    width: 100%; 
    flex-direction: column; 
    align-items: center; 
    min-height: 100vh; /* Wächst mit dem Inhalt mit */
}

/* Damit die Schubladen beim Öffnen nicht den Rahmen sprengen */
.schublade.open .schublade-content { 
    max-height: none; /* Vorher 400px - jetzt soviel Platz wie nötig */
    padding: 15px; 
    border-top: 1px solid #003d8f; 
}

        /* EBENE 5: ADMIN ZONE */
        .freie-zone-text { font-size: 3rem; font-weight: 900; color: #ffd700; text-align: center; margin-top: 50px; text-shadow: 0 0 20px #ffd700; }

        /* NAVIGATION */
        .bottom-nav { display: flex; justify-content: space-between; width: 100%; padding: 10px 20px; position: fixed; bottom: 0; left: 0; box-sizing: border-box; background: #000; z-index: 100; border-top: 1px solid #333; }
        .nav-btn { background: #ffd700; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .dot { width: 10px; height: 10px; background: #444; border-radius: 50%; }
        .dot.active { background: #ffd700; box-shadow: 0 0 10px #ffd700; }

        #counter-box { position: absolute; right: 0; top: 0; width: 100px; padding: 5px; border-left: 2px solid #003d8f; border-bottom: 2px solid #003d8f; background: #000; text-align: center; display: none; z-index: 100; }
        .counter-value { font-size: 0.85rem; font-weight: 900; color: #ff0000; }
        .top-container { width: 100%; display: flex; flex-direction: column; align-items: center; margin-top: 1vh; flex-shrink: 0; }
        .page-title-white { text-transform: uppercase; font-size: 1.8rem; margin-bottom: 5px; font-weight: 900; color: #fff; }
        .ebene4-header-red { width: 90%; background: #ff0000; color: #fff; padding: 10px 0; text-align: center; font-weight: 900; font-size: 1.5rem; border-radius: 5px 5px 0 0; display: none; }

        .num-neutral { background-color: #003d8f !important; }
        .num-gelesen { background-color: #ffd700 !important; color: #000 !important; }
        .num-offen { background-color: #ff4d4d !important; }
        .num-fertig { background-color: #00ff00 !important; color: #000 !important; }

        .werbe-bild-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; z-index: 1; }
        .bild-aktiv { animation: kenburns 20s infinite ease-in-out, fadeEffect 10s infinite; }
    </style>
</head>
<body>

    <div id="dashboard" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <div class="dashboard-header">
            <div class="logo-ring" ondblclick="adminUnlock()"><div class="logo-mm">M&M</div><div class="logo-community">COMMUNITY</div></div>
        </div>
        <div class="info-section">
            <h1 style="font-size: 2.8rem; margin: 0; font-weight: 900;">DAS WAS & WARUM</h1>
            <h2 style="color: #003d8f; font-size: 1.8rem; margin: 5px 0;">DIE STILLE MILLION</h2>
            <p style="max-width: 85%; color: #ccc; font-size: 1.1rem; margin: 10px 0 0 0; text-align: center;">
                Die M&M-Community ist das Fundament für alle. <strong>Die Wahl der Vorsitzenden erfolgt erst nach Erreichen der stillen Million.</strong>
            </p>
        </div>
        <div class="grid" id="main-grid"></div>
        <div class="fundament-container" style="display: flex; width: 95%; max-width: 1450px; gap: 10px; margin-top: 10px; margin-bottom: 10px;">
            <div class="fundament-box" style="flex: 1;"><div class="num">21</div><div class="text">Kapital und Verwaltung</div></div>
            <div class="fundament-box" style="flex: 1;"><div class="num">22</div><div class="text">DAS KOLLEKTIV</div></div>
        </div>

        <div class="zugang-container" style="display: flex; width: 95%; max-width: 1450px; gap: 10px; margin-bottom: 80px;">
            <div class="fundament-box" style="flex: 1; border-color: #555; cursor: pointer;" onclick="showZugangInfo('gast')">
                <div class="num" style="background-color: #333;">G</div>
                <div class="text">Gast-Zugang (Eingeschränkt)</div>
            </div>
            <div class="fundament-box" style="flex: 1; border-color: #8b00ff; cursor: pointer;" onclick="showZugangInfo('email')">
                <div class="num" style="background-color: #8b00ff;">V</div>
                <div class="text" style="color: #ffd700;">Verifizierter Status (Voller Zugriff 1-4)</div>
            </div>
        </div>
    </div>

    <div id="zugang-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center;">
        <div style="background:#000; border:2px solid #003d8f; padding:30px; width:400px; text-align:center; border-radius:10px;">
            <h3 id="modal-titel" style="color:#fff; margin-top:0;"></h3>
            <p id="modal-text" style="color:#ccc; font-size:0.9rem; line-height:1.5; margin:20px 0;"></p>
            <div id="email-input-field" style="display:none; margin-bottom:20px;">
                <input type="email" id="user-email-input" placeholder="Deine E-Mail Adresse" style="width:90%; padding:10px; background:#111; border:1px solid #8b00ff; color:#fff;">
            </div>
            <button id="modal-confirm-btn" style="background:#ffd700; color:#000; border:none; padding:10px 20px; font-weight:bold; cursor:pointer; margin-right:10px;">AKZEPTIEREN</button>
            <button onclick="document.getElementById('zugang-modal').style.display='none'" style="background:#333; color:#fff; border:none; padding:10px 20px; cursor:pointer;">ABBRECHEN</button>
        </div>
    </div>

    <div id="page-skelett" style="display: none; width: 100%; flex-direction: column; align-items: center; height: 100vh;">
        <div class="top-container">
            <h1 id="info-titel" class="page-title-white"></h1>
            <div id="ebene4-title-red" class="ebene4-header-red">DER VIDEO-BEWEIS</div>
            <div class="tafel-layout">
                <div class="buttons-links">
                    <div class="oval-side ov-schwarz" id="sig-l1"></div>
                    <div class="oval-side ov-grun" id="sig-l2"></div>
                    <div class="oval-side ov-blau" id="sig-l3"></div>
                    <div class="oval-side ov-rot" id="sig-l4" onclick="portalZuEbene4()"></div>
                </div>
                <div class="info-section-ebene">
                    <div class="werbe-bild-bg" id="werbe-bg"></div>
                    <div id="counter-box"><span style="font-size:0.4rem; color:#fff; display:block;">STILLE MILLION</span><span class="counter-value">842.336</span></div>
                    <div style="z-index: 5; text-align: center; font-weight: bold; color: rgba(255,255,255,0.3); letter-spacing: 5px;">PLATZ FÜR WERBUNG</div>
                </div>
                <div class="buttons-rechts">
                    <div class="oval-side ov-grun" id="sig-r1"></div>
                    <div class="oval-side ov-blau" id="sig-r2"></div>
                    <div class="oval-side ov-pink" id="sig-r3"></div>
                    <div class="oval-side ov-gelb" id="sig-r4" onclick="portalZuEbene3()"></div>
                </div>
            </div>
            <div id="lila-balken-container" style="display: none; width: 100%;">
                <div class="lila-registrierung-leiste"><div class="registrierung-text">REGISTRIERUNG</div></div>
            </div>
        </div>

        <p id="main-text" style="width: 85%; text-align: justify; color: #ccc; margin-top: 2vh; font-size: 1.3rem; line-height: 1.8; max-height: 50vh; overflow-y: auto;"></p>

        <div id="chat-area">
            <div class="chat-msgs" id="chat-box"><i>System: Dialog bereit...</i></div>
            <div class="chat-input-row">
                <input type="text" id="chat-input" placeholder="Nachricht schreiben..." style="flex:1; background:transparent; border:none; color:#fff; padding:15px; outline:none;" onkeypress="if(event.key==='Enter') registriereSenden()">
                <button onclick="registriereSenden()" style="background:#003d8f; color:#fff; border:none; padding:0 30px; font-weight:bold; cursor:pointer;">SENDEN</button>
            </div>
        </div> 

        <div id="drawer-ebene4">
            <div class="video-grid">
                <div class="video-slot slot-1-user" id="v-slot-1">SLOT 1 (DU)</div>
                <div class="video-slot" id="v-slot-2">SLOT 2 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-3">SLOT 3 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-4">SLOT 4 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-5">SLOT 5 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-6">SLOT 6 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-7">SLOT 7 (ZUFALL)</div>
                <div class="video-slot" id="v-slot-8">SLOT 8 (ZUFALL)</div>
            </div>
            <button onclick="starteVideoKonferenz()" style="width: 100%; background: #00ff00; color: #000; border: none; padding: 12px; font-weight: bold; cursor: pointer; border-radius: 5px; flex-shrink:0;">JETZT ZUFÄLLIGEM DIALOG BEITRETEN</button>
            <div id="sektoren-schubladen"></div>
        </div> 

        <div id="ebene5-bereich" style="display:none;"><div class="freie-zone-text">ADMIN ZONE</div></div>
    </div>

    <div class="bottom-nav">
        <button id="btn-back" class="nav-btn" style="visibility: hidden;" onclick="showDashboard()">← Dashboard</button>
        <div style="display: flex; gap: 8px; align-items: center;" id="dot-holder"></div>
        <button id="btn-next" class="nav-btn" style="visibility: hidden;" onclick="nextPage()">Weiter →</button>
    </div>

<script>
    let userBackstage = { sektorZeiten: Array(20).fill(0), isQualifiziert: false, isVerifiziert: false, stammSektor: null, rankingPlatz: 5 };
    const themen = ["Recht auf Gefühls Forderung", "Wie werde ich Mensch", "Glaube an Friede", "Programm für Bürgerliche Rechte", "Moralische Pflicht und Verantwortung", "Menschlichkeit Wiederherstellung", "Kinderschutz-Pflicht-Elternrechte", "Wahre Richtung und Kunst", "LGBTQ und Kirche", "Trend and Tradition", "Religionsbekenntnis oder Selbstwahl", "Gesundheitswesen und Verhalten", "Arbeitswelt und Du", "Mobbing am Arbeitsplatz", "Jugendsprecher", "Ratgeber für Pensionisten", "Sozialgefallen und Widerkehr", "Nachbarschaft und Gemeinschaft", "Mensch und Technik", "Die Brücke"];
    let ebene = 1, tId = 0, aktuellesThema = "", wechselInterval, geleseneThemen = new Set(), interaktionsZaehler = {};
    themen.forEach((t, i) => { interaktionsZaehler[i] = 0; });

    const grid = document.getElementById('main-grid');
    themen.forEach((t, i) => { grid.innerHTML += `<div class="box" id="box-${i}"><div class="num num-neutral" id="num-${i}">${i+1}</div><div class="text" onclick="checkAccess(${i}, '${t}')">${t}</div></div>`; });
    
    const drawerArea = document.getElementById('sektoren-schubladen');
    themen.forEach((t, i) => {
        drawerArea.innerHTML += `
            <div class="schublade" id="drawer-${i}">
                <div class="schublade-header" onclick="toggleDrawer(${i})">
                    <span>SEKTOR ${i+1}: ${t}</span>
                    <span id="arrow-${i}">▼</span>
                </div>
                <div class="schublade-content">
                    Hier liegen die Dokumente und Beweise für den Sektor "${t}". 
                    Die Wahl der Vorsitzenden erfolgt erst nach der stillen Million.
                </div>
            </div>`;
    });

    const dots = document.getElementById('dot-holder');
    for(let i=1; i<=7; i++) dots.innerHTML += `<div id="dot${i}" class="dot ${i===1?'active':''}"></div>`;

    function showZugangInfo(typ) {
        const modal = document.getElementById('zugang-modal');
        const titel = document.getElementById('modal-titel');
        const text = document.getElementById('modal-text');
        const emailField = document.getElementById('email-input-field');
        const confirmBtn = document.getElementById('modal-confirm-btn');
        modal.style.display = 'flex';
        if(typ === 'gast') {
            titel.innerText = "Gast-Modus";
            titel.style.color = "#fff";
            text.innerText = "Dein Fortschritt wird nur lokal gespeichert. Löschst du deinen Browser-Verlauf, musst du in Ebene 1 neu beginnen.";
            emailField.style.display = 'none';
            confirmBtn.onclick = () => { userBackstage.isVerifiziert = false; modal.style.display = 'none'; alert("Gast-Modus aktiv."); };
        } else {
            titel.innerText = "Verifizierter Status";
            titel.style.color = "#ffd700";
            text.innerText = "Alle freigeschalteten Sektoren bleiben dauerhaft gesichert.";
            emailField.style.display = 'block';
            confirmBtn.onclick = () => { 
                const mail = document.getElementById('user-email-input').value;
                if(mail.includes('@')) {
                    userBackstage.isVerifiziert = true;
                    modal.style.display = 'none'; 
                    alert("Verifizierung erfolgreich!");
                } else { alert("Bitte gib eine gültige E-Mail ein."); }
            };
        }
    }

    function checkAccess(id, t) {
        if (userBackstage.isVerifiziert || geleseneThemen.has(id) || id === 0 || geleseneThemen.size >= id) {
            showInfo(t, id);
        } else {
            alert("Bitte bearbeite die Sektoren der Reihe nach.");
        }
    }

    function toggleDrawer(id) {
        const d = document.getElementById(`drawer-${id}`);
        const arrow = document.getElementById(`arrow-${id}`);
        const isOpen = d.classList.contains('open');
        document.querySelectorAll('.schublade').forEach(s => s.classList.remove('open'));
        document.querySelectorAll('.schublade-header span[id^="arrow"]').forEach(a => a.innerText = '▼');
        if (!isOpen) { d.classList.add('open'); arrow.innerText = '▲'; }
    }

    function adminUnlock() {
        themen.forEach((_, i) => { geleseneThemen.add(i); interaktionsZaehler[i] = 20; });
        userBackstage.isQualifiziert = true;
        userBackstage.isVerifiziert = true;
        updateNumColors();
        updateUI();
        alert("ADMIN: Alle Barrieren entfernt.");
    }

    function showInfo(t, id) { 
        tId = id; aktuellesThema = t; 
        document.getElementById('chat-box').innerHTML = `<i>System: Dialog für Raum ${id+1} bereit...</i>`;
        if (geleseneThemen.has(id)) { ebene = 3; } else { ebene = 2; geleseneThemen.add(id); }
        updateNumColors(); 
        document.getElementById('dashboard').style.display = 'none'; 
        document.getElementById('page-skelett').style.display = 'flex'; 
        updateUI(); 
    } 

    function portalZuEbene3() { if (document.getElementById('sig-r4').classList.contains('signal-aktiv')) { ebene = 3; updateUI(); } }
    function portalZuEbene4() { if (document.getElementById('sig-l4').classList.contains('signal-aktiv')) { ebene = 4; updateUI(); } }
    function portalZuEbene5() { if (document.getElementById('sig-l1').classList.contains('elite-aktiv')) { ebene = 5; updateUI(); } }

    function updateUI() {
        const isChat = (ebene === 3), isVideo = (ebene === 4), isAdmin = (ebene === 5);
        document.getElementById('chat-area').style.display = isChat ? 'flex' : 'none';
        document.getElementById('drawer-ebene4').style.display = isVideo ? 'flex' : 'none';
        document.getElementById('ebene5-bereich').style.display = isAdmin ? 'flex' : 'none';
        document.getElementById('lila-balken-container').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('main-text').style.display = (ebene < 3) ? 'block' : 'none';
        document.getElementById('ebene4-title-red').style.display = isVideo ? 'block' : 'none';
        document.getElementById('info-titel').style.display = (isVideo || isAdmin) ? 'none' : 'block';
        document.getElementById('counter-box').style.display = ebene >= 3 ? 'block' : 'none';
        document.getElementById('btn-back').style.visibility = 'visible';
        document.getElementById('info-titel').innerText = aktuellesThema;
        if (ebene === 2) document.getElementById('main-text').innerText = "Inhalt für " + aktuellesThema + "...";

        const btnNext = document.getElementById('btn-next');
        const sigGelb = document.getElementById('sig-r4');
        const sigRot = document.getElementById('sig-l4');
        const sigL1 = document.getElementById('sig-l1');

        if (ebene === 2) {
            btnNext.style.visibility = (tId < 19) ? 'visible' : 'hidden';
            sigGelb.classList.toggle('signal-aktiv', geleseneThemen.size === 20);
        } else sigGelb.classList.remove('signal-aktiv');

        if (ebene === 3) {
            btnNext.style.visibility = (tId < 19) ? 'visible' : 'hidden';
            let alleFertig = Object.values(interaktionsZaehler).every(val => val >= 20);
            sigRot.classList.toggle('signal-aktiv', alleFertig);
        } else sigRot.classList.remove('signal-aktiv');

        if (userBackstage.isQualifiziert && ebene < 5) {
            sigL1.className = "oval-side elite-aktiv";
            sigL1.onclick = portalZuEbene5;
        } else {
            sigL1.className = "oval-side ov-schwarz";
            sigL1.onclick = null;
        }
        updateDots(); 
        startRotation();
    }

    function updateDots() { for(let i=1; i<=7; i++) { const d = document.getElementById('dot'+i); if(d) d.classList.toggle('active', i === ebene); } }
    
    function nextPage() { 
        if ((ebene === 2 || ebene === 3) && tId < 19) { 
            tId++; aktuellesThema = themen[tId];
            document.getElementById('chat-box').innerHTML = `<i>System: Dialog für Raum ${tId+1} bereit...</i>`;
            if (ebene === 2) geleseneThemen.add(tId);
            updateUI(); updateNumColors();
        } else if (ebene < 7 && ebene !== 2 && ebene !== 3 && ebene !== 4 && ebene !== 5) { ebene++; updateUI(); } 
    }

    function showDashboard() { ebene = 1; document.getElementById('page-skelett').style.display = 'none'; document.getElementById('dashboard').style.display = 'flex'; updateNumColors(); }
    
    function registriereSenden() { 
        const input = document.getElementById('chat-input'), 
              chatBox = document.getElementById('chat-box'), 
              text = input.value.trim(); 
        if (text === "") return; 
        chatBox.innerHTML += `<div style="margin-bottom: 8px;"><strong>Du:</strong> ${text}</div>`; 
        if (interaktionsZaehler[tId] < 20) interaktionsZaehler[tId]++; 
        input.value = ""; 
        chatBox.scrollTop = chatBox.scrollHeight; 
        updateUI(); 
    }

    function updateNumColors() {
        themen.forEach((_, i) => {
            const nBox = document.getElementById(`num-${i}`);
            if (nBox) {
                if (interaktionsZaehler[i] >= 20) nBox.className = "num num-fertig";
                else if (interaktionsZaehler[i] > 0) nBox.className = "num num-offen";
                else if (geleseneThemen.has(i)) nBox.className = "num num-gelesen";
                else nBox.className = "num num-neutral";
            }
        });
    }

    function startRotation() { 
        clearInterval(wechselInterval); 
        const bg = document.getElementById('werbe-bg'); 
        if(!bg) return; 
        bg.style.backgroundImage = `url('https://picsum.photos/seed/${tId + ebene}/1200/600')`; 
        bg.classList.add('bild-aktiv'); 
    }

    async function starteVideoKonferenz() {
        const meinSlot = document.getElementById('v-slot-1');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            meinSlot.innerHTML = `<video id="user-video" autoplay playsinline style="width:100%; height:100%; object-fit:cover;"></video>`;
            document.getElementById('user-video').srcObject = stream;
            for(let i=2; i<=8; i++) {
                const s = document.getElementById(`v-slot-${i}`);
                s.innerHTML = `<div class="pulsieren" style="color:#ffd700;">VERBUNDEN</div>`;
            }
        } catch (err) { alert("Kamera-Fehler"); }
    }
</script>
</body>
</html>
