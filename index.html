<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>M&M-COMMUNITY - Fixed Mode</title>
    <style>
        /* CSS BASIS - REPARIERT */
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        @keyframes kenburns { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }
        @keyframes signalBlink { 0% { box-shadow: 0 0 5px #fff; } 50% { box-shadow: 0 0 25px #fff, 0 0 35px #003d8f; transform: scale(1.05); } 100% { box-shadow: 0 0 5px #fff; } }
        
        .signal-aktiv { animation: signalBlink 1.0s infinite ease-in-out !important; border: 2px solid #fff !important; cursor: pointer; }
        .dashboard-header { width: 100%; padding: 20px; z-index: 20; position: relative; }
        .logo-ring { width: 110px; height: 110px; border: 3px solid #fff; background-color: #003d8f; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        
        .info-section { width: 80%; height: 26vh; border: 2px solid #003d8f; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #000; position: relative; overflow: hidden; margin-top: 2vh; }
        .tafel-layout { display: flex; align-items: center; justify-content: center; width: 100%; position: relative; height: 26vh; flex-shrink: 0; margin-top: 10px; }
        .info-section-ebene { width: 80%; height: 100%; border: 2px solid #003d8f; position: relative; overflow: hidden; background: #000; }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 95%; max-width: 1450px; margin-top: 20px; padding-bottom: 100px; overflow-y: auto; }
        .box { display: flex; border: 2px solid #003d8f; background-color: #000; min-height: 50px; }
        .num { width: 40px; display: flex; align-items: center; justify-content: center; background-color: #003d8f; font-weight: bold; }
        .text { padding: 10px; font-size: 0.7rem; cursor: pointer; flex-grow: 1; text-transform: uppercase; }

        /* SCROLLBEREICH FÜR EBENE 4 GEFIXT */
        #drawer-ebene4 { width: 90%; display: none; flex-direction: column; height: 60vh; overflow-y: scroll; padding-bottom: 150px; margin-top: 10px; }
        .video-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; flex-shrink: 0; }
        .video-slot { aspect-ratio: 16/9; background: #111; border: 1px solid #003d8f; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #444; }

        .schublade { border: 1px solid #003d8f; margin-bottom: 10px; background: #050505; width: 100%; }
        .schublade-header { padding: 15px; cursor: pointer; background: #001a3d; display: flex; justify-content: space-between; font-weight: bold; }
        .schublade-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: #000; }
        .schublade.open .schublade-content { max-height: 600px; padding: 15px; border-top: 1px solid #003d8f; }
        .schublade-textarea { width: 100%; height: 200px; background: #111; color: #fff; border: 1px solid #003d8f; resize: none; padding: 10px; box-sizing: border-box; }

        /* WERBE-BILDER ROTATION */
        .werbe-bild-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; transition: opacity 1.5s ease-in-out; opacity: 0; }
        .bild-sichtbar { opacity: 0.6; animation: kenburns 10s infinite alternate; }

        .buttons-links, .buttons-rechts { display: flex; flex-direction: column; gap: 10px; padding: 0 15px; }
        .oval-side { width: 45px; height: 22px; border: 1px solid #fff; border-radius: 12px; cursor: pointer; opacity: 0.7; }

        #chat-area { width: 90%; height: 50vh; display: none; flex-direction: column; margin-top: 20px; }
        .chat-msgs { flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #003d8f; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-between; padding: 15px; border-top: 1px solid #333; z-index: 1000; }
        .nav-btn { background: #ffd700; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }

        .num-neutral { background-color: #003d8f; }
        .num-gelesen { background-color: #ffd700; color: #000; }
        .num-fertig { background-color: #00ff00; color: #000; }
    </style>
</head>
<body>

    <div id="dashboard" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <div class="dashboard-header"><div class="logo-ring" ondblclick="adminUnlock()">M&M</div></div>
        <div class="info-section"><h1>M&M COMMUNITY</h1><p>DAS WAS & WARUM</p></div>
        <div class="grid" id="main-grid"></div>
    </div>

    <div id="page-skelett" style="display: none; width: 100%; flex-direction: column; align-items: center;">
        <div class="tafel-layout">
            <div class="buttons-links"><div class="oval-side" style="background: #000;"></div><div class="oval-side" id="sig-l4" style="background: red;"></div></div>
            <div class="info-section-ebene" id="werbe-container">
                <div id="bg-1" class="werbe-bild-bg"></div>
                <div id="bg-2" class="werbe-bild-bg"></div>
            </div>
            <div class="buttons-rechts"><div class="oval-side" style="background: green;"></div><div class="oval-side" id="sig-r4" style="background: yellow;" onclick="portalZuEbene3()"></div></div>
        </div>

        <h2 id="info-titel"></h2>
        <div id="main-text" style="width: 80%; padding: 10px; text-align: center;"></div>

        <div id="chat-area">
            <div class="chat-msgs" id="chat-box"></div>
            <div style="display:flex; margin-top:10px;">
                <input type="text" id="chat-input" style="flex:1; padding:10px;" onkeypress="if(event.key==='Enter') registriereSenden()">
                <button onclick="registriereSenden()" style="padding:10px;">SENDEN</button>
            </div>
        </div>

        <div id="drawer-ebene4">
            <div class="video-grid" id="v-grid"></div>
            <div id="sektoren-schubladen"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn" onclick="showDashboard()">← Menü</button>
        <button id="btn-next" class="nav-btn" onclick="nextPage()" style="display:none;">Nächster Sektor →</button>
    </div>

<script>
    let tId = 0, ebene = 1, isVerifiziert = false, bildIntervall;
    let interaktionsZaehler = Array(20).fill(0);
    let geleseneThemen = new Set();
    const themen = ["Recht auf Gefühls Forderung", "Wie werde ich Mensch", "Glaube an Friede", "Programm für Bürgerliche Rechte", "Moralische Pflicht und Verantwortung", "Menschlichkeit Wiederherstellung", "Kinderschutz-Pflicht-Elternrechte", "Wahre Richtung und Kunst", "LGBTQ und Kirche", "Trend and Tradition", "Religionsbekenntnis oder Selbstwahl", "Gesundheitswesen und Verhalten", "Arbeitswelt und Du", "Mobbing am Arbeitsplatz", "Jugendsprecher", "Ratgeber für Pensionisten", "Sozialgefallen und Widerkehr", "Nachbarschaft und Gemeinschaft", "Mensch und Technik", "Die Brücke"];

    // GRID INITIALISIEREN
    const grid = document.getElementById('main-grid');
    themen.forEach((t, i) => {
        grid.innerHTML += `<div class="box"><div class="num num-neutral" id="num-${i}">${i+1}</div><div class="text" onclick="checkAccess(${i})">${t}</div></div>`;
    });

    // EBENE 4 INITIALISIEREN (Video & Schubladen)
    const vGrid = document.getElementById('v-grid');
    for(let i=1; i<=8; i++) vGrid.innerHTML += `<div class="video-slot">VIDEO SLOT ${i}</div>`;

    const drawerArea = document.getElementById('sektoren-schubladen');
    themen.forEach((t, i) => {
        drawerArea.innerHTML += `
            <div class="schublade" id="drawer-${i}">
                <div class="schublade-header" onclick="toggleDrawer(${i})"><span>${i+1}. ${t}</span><span>▼</span></div>
                <div class="schublade-content">
                    <textarea class="schublade-textarea" placeholder="Deine Gedanken zu Sektor ${i+1}..."></textarea>
                    <button style="margin-top:10px; padding:5px 15px;" onclick="alert('Gespeichert!')">Speichern</button>
                </div>
            </div>`;
    });

    function toggleDrawer(id) {
        const el = document.getElementById(`drawer-${id}`);
        el.classList.toggle('open');
    }

    function checkAccess(id) {
        // FIX: Kein blinder Passagier - Man muss den Sektor davor besucht haben
        if (id === 0 || geleseneThemen.has(id - 1)) {
            tId = id; showInfo();
        } else {
            alert("Halt! Bitte schalte erst Sektor " + id + " frei.");
        }
    }

    function showInfo() {
        ebene = 2; geleseneThemen.add(tId);
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('page-skelett').style.display = 'flex';
        document.getElementById('info-titel').innerText = themen[tId];
        document.getElementById('main-text').innerHTML = `Inhalt für Sektor ${tId+1}: ${themen[tId]}`;
        startWerbung();
        updateUI();
    }

    function startWerbung() {
        clearInterval(bildIntervall);
        let current = 1;
        const rotate = () => {
            const next = current === 1 ? 2 : 1;
            const bNext = document.getElementById(`bg-${next}`);
            const bCurr = document.getElementById(`bg-${current}`);
            bNext.style.backgroundImage = `url('https://picsum.photos/seed/${Math.random()}/1200/600')`;
            bNext.classList.add('bild-sichtbar');
            bCurr.classList.remove('bild-sichtbar');
            current = next;
        };
        rotate();
        bildIntervall = setInterval(rotate, 5000);
    }

    function registriereSenden() {
        const inp = document.getElementById('chat-input');
        if(!inp.value.trim()) return;
        document.getElementById('chat-box').innerHTML += `<div><strong>Du:</strong> ${inp.value}</div>`;
        interaktionsZaehler[tId]++;
        inp.value = "";
        updateUI();
    }

    function updateUI() {
        document.getElementById('chat-area').style.display = (ebene === 3) ? 'flex' : 'none';
        document.getElementById('drawer-ebene4').style.display = (ebene === 4) ? 'flex' : 'none';
        document.getElementById('main-text').style.display = (ebene === 2) ? 'block' : 'none';
        document.getElementById('btn-next').style.display = (isVerverified && ebene === 2 && tId < 19) ? 'block' : 'none';
        
        // Signal-Logik: Erst wenn alle 20 Sektoren besucht wurden
        const alleBesucht = geleseneThemen.size >= 20;
        document.getElementById('sig-r4').classList.toggle('signal-aktiv', ebene === 2 && alleBesucht);
        document.getElementById('sig-l4').classList.toggle('signal-aktiv', ebene === 3 && interaktionsZaehler[tId] >= 20 && alleBesucht);
        
        updateNumColors();
    }

    function portalZuEbene3() { if(geleseneThemen.size >= 20) { ebene = 3; updateUI(); } }
    function portalZuEbene4() { if(interaktionsZaehler[tId] >= 20) { ebene = 4; updateUI(); } }
    
    function nextPage() { if(tId < 19) { tId++; showInfo(); } }
    function showDashboard() { ebene = 1; clearInterval(bildIntervall); document.getElementById('page-skelett').style.display = 'none'; document.getElementById('dashboard').style.display = 'flex'; }

    function updateNumColors() {
        themen.forEach((_, i) => {
            const n = document.getElementById(`num-${i}`);
            if(interaktionsZaehler[i] >= 20) n.className = "num num-fertig";
            else if(geleseneThemen.has(i)) n.className = "num num-gelesen";
        });
    }

    function adminUnlock() { 
        isVerverified = true; 
        alert("Status: Verifiziert."); 
        updateUI(); 
    }
</script>
</body>
</html>
