<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>M&M-COMMUNITY - Final Fixed</title>
    <style>
        body { background-color: #000; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        @keyframes kenburns { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }
        @keyframes signalBlink { 0% { box-shadow: 0 0 5px #fff; opacity: 0.8; } 50% { box-shadow: 0 0 25px #fff, 0 0 35px #003d8f; opacity: 1; transform: scale(1.05); } 100% { box-shadow: 0 0 5px #fff; opacity: 0.8; } }
        
        .elite-aktiv { background-color: #ffd700 !important; box-shadow: 0 0 10px #ffd700; border: 2px solid #fff !important; cursor: pointer; }
        .signal-aktiv { animation: signalBlink 1.0s infinite ease-in-out !important; border: 2px solid #fff !important; cursor: pointer; }
        
        .dashboard-header { width: 100%; position: absolute; top: 3%; display: flex; justify-content: flex-start; padding: 0 2%; box-sizing: border-box; z-index: 20; }
        .logo-ring { width: 110px; height: 110px; border: 3px solid #fff; background-color: #003d8f; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; }
        .logo-mm { font-size: 2rem; font-weight: 900; line-height: 0.8; }
        .logo-community { font-size: 0.6rem; letter-spacing: 1.5px; text-transform: uppercase; font-weight: bold; }

        .info-section { width: 80%; height: 26vh; border: 2px solid #003d8f; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #000; position: relative; overflow: hidden; margin-top: 2vh; }
        .tafel-layout { display: flex; align-items: center; justify-content: center; width: 100%; position: relative; margin-top: 1vh; height: 26vh; min-height: 26vh; flex-shrink: 0; }
        .info-section-ebene { width: 90% !important; height: 100%; border: 2px solid #003d8f; background-color: #000; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        
        .werbe-bild-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; z-index: 1; transition: opacity 1.5s ease-in-out; }
        .bild-aktiv { opacity: 0.4 !important; animation: kenburns 10s infinite alternate; }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); grid-auto-flow: column; gap: 10px; width: 95%; max-width: 1450px; margin-top: 30px; border: 3px solid #00ff00; padding: 15px; border-radius: 10px; overflow-y: auto; }
        .box, .fundament-box { display: flex; border: 2px solid #003d8f; background-color: #000; min-height: 58px; position: relative; overflow: hidden; }
        .num { width: 38px; display: flex; align-items: center; justify-content: center; background-color: #003d8f; font-weight: bold; flex-shrink: 0; font-size: 0.85rem; }
        .text { padding: 4px 8px; text-transform: uppercase; font-size: 0.6rem; display: flex; align-items: center; cursor: pointer; flex-grow: 1; font-weight: 600; }

        /* EBENE 4 SCROLL FIX */
        #drawer-ebene4 { overflow-y: auto; scroll-behavior: smooth; width: 90%; display: none; flex-direction: column; height: 60vh; padding-bottom: 100px; }
        .video-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; flex-shrink: 0; margin-bottom: 20px; }
        .video-slot { aspect-ratio: 16/9; background: #111; border: 1px solid #003d8f; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #666; }
        
        .schublade { border: 1px solid #003d8f; margin-bottom: 10px; background: #050505; }
        .schublade-header { padding: 15px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; background: #001a3d; border-bottom: 1px solid #003d8f; }
        .schublade-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; background: #000; }
        .schublade.open .schublade-content { max-height: 1200px; padding: 20px; }
        .schublade-textarea { width: 100%; height: 250px; background: #111; border: 1px solid #003d8f; color: #fff; padding: 10px; font-family: inherit; resize: none; }

        .buttons-links { position: absolute; left: 1.5%; display: flex; flex-direction: column; gap: 15px; z-index: 20; }
        .buttons-rechts { position: absolute; right: 1.5%; display: flex; flex-direction: column; gap: 15px; z-index: 20; }
        .oval-side { width: 45px; height: 22px; border-radius: 12px; border: 1px solid #fff; opacity: 0.8; cursor: pointer; }
        
        #chat-area { width: 90%; height: 45vh; display: none; flex-direction: column; margin-bottom: 80px; }
        .chat-msgs { flex: 1; overflow-y: auto; padding: 10px; border: 1px solid #003d8f; margin-bottom: 10px; }
        
        .bottom-nav { display: flex; justify-content: space-between; width: 100%; padding: 10px 20px; position: fixed; bottom: 0; background: #000; border-top: 1px solid #333; z-index: 100; }
        .nav-btn { background: #ffd700; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .dot { width: 10px; height: 10px; background: #444; border-radius: 50%; }
        .dot.active { background: #ffd700; box-shadow: 0 0 10px #ffd700; }

        .num-neutral { background-color: #003d8f !important; }
        .num-gelesen { background-color: #ffd700 !important; color: #000 !important; }
        .num-offen { background-color: #ff4d4d !important; }
        .num-fertig { background-color: #00ff00 !important; color: #000 !important; }
    </style>
</head>
<body>

    <div id="dashboard" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <div class="dashboard-header">
            <div class="logo-ring" ondblclick="adminUnlock()"><div class="logo-mm">M&M</div><div class="logo-community">COMMUNITY</div></div>
        </div>
        <div class="info-section">
            <h1 style="font-size: 2.8rem; margin: 0; font-weight: 900;">DAS WAS & WARUM</h1>
            <h2 style="color: #003d8f; font-size: 1.8rem; margin: 5px 0;">DIE STILLE MILLION</h2>
        </div>
        <div class="grid" id="main-grid"></div>
        <div class="fundament-container" style="display: flex; width: 95%; max-width: 1450px; gap: 10px; margin: 10px 0 80px 0;">
            <div class="fundament-box" style="flex: 1;"><div class="num">21</div><div class="text">Kapital und Verwaltung</div></div>
            <div class="fundament-box" style="flex: 1;"><div class="num">22</div><div class="text">DAS KOLLEKTIV</div></div>
        </div>
    </div>

    <div id="page-skelett" style="display: none; width: 100%; flex-direction: column; align-items: center;">
        <div class="tafel-layout">
            <div class="buttons-links">
                <div class="oval-side" id="sig-l1" style="background:#000;"></div>
                <div class="oval-side" style="background:green;"></div>
                <div class="oval-side" style="background:blue;"></div>
                <div class="oval-side" id="sig-l4" style="background:red;" onclick="portalZuEbene4()"></div>
            </div>
            <div class="info-section-ebene">
                <div class="werbe-bild-bg" id="werbe-bg"></div>
                <div style="z-index: 5; font-weight: bold; color: rgba(255,255,255,0.5);">M&M COMMUNITY TAFEL</div>
            </div>
            <div class="buttons-rechts">
                <div class="oval-side" style="background:green;"></div>
                <div class="oval-side" style="background:blue;"></div>
                <div class="oval-side" style="background:pink;"></div>
                <div class="oval-side" id="sig-r4" style="background:yellow;" onclick="portalZuEbene3()"></div>
            </div>
        </div>

        <h1 id="info-titel" style="text-transform:uppercase; margin: 10px 0;"></h1>
        <p id="main-text" style="width: 80%; text-align: center; color: #ccc;"></p>

        <div id="chat-area">
            <div class="chat-msgs" id="chat-box"></div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-input" placeholder="Nachricht..." style="flex:1; padding:10px; background:#111; color:#fff; border:1px solid #003d8f;">
                <button onclick="registriereSenden()" style="padding:10px 20px; background:#003d8f; color:#fff; border:none; cursor:pointer;">SENDEN</button>
            </div>
        </div>

        <div id="drawer-ebene4">
            <div class="video-grid" id="v-grid"></div>
            <button id="video-btn" onclick="alert('Verbindung wird aufgebaut...')" style="width: 100%; background: #00ff00; color: #000; border: none; padding: 12px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-bottom: 20px;">JETZT ZUFÄLLIGEM DIALOG BEITRETEN</button>
            <div id="sektoren-schubladen"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn" onclick="showDashboard()">← Dashboard</button>
        <div style="display: flex; gap: 8px;" id="dot-holder"></div>
        <button id="btn-next" class="nav-btn" onclick="nextPage()" style="visibility:hidden;">Weiter →</button>
    </div>

<script>
    const themen = ["Recht auf Gefühls Forderung", "Wie werde ich Mensch", "Glaube an Friede", "Programm für Bürgerliche Rechte", "Moralische Pflicht und Verantwortung", "Menschlichkeit Wiederherstellung", "Kinderschutz-Pflicht-Elternrechte", "Wahre Richtung und Kunst", "LGBTQ und Kirche", "Trend and Tradition", "Religionsbekenntnis oder Selbstwahl", "Gesundheitswesen und Verhalten", "Arbeitswelt und Du", "Mobbing am Arbeitsplatz", "Jugendsprecher", "Ratgeber für Pensionisten", "Sozialgefallen und Widerkehr", "Nachbarschaft und Gemeinschaft", "Mensch und Technik", "Die Brücke"];
    let ebene = 1, tId = 0, isVerifiziert = false, isQualifiziert = false;
    let geleseneThemen = new Set(), interaktionsZaehler = Array(20).fill(0), werbeIntervall;

    // Grid & Drawer Init
    const grid = document.getElementById('main-grid');
    themen.forEach((t, i) => {
        grid.innerHTML += `<div class="box"><div class="num num-neutral" id="num-${i}">${i+1}</div><div class="text" onclick="checkAccess(${i})">${t}</div></div>`;
    });

    const drawerArea = document.getElementById('sektoren-schubladen');
    themen.forEach((t, i) => {
        drawerArea.innerHTML += `
            <div class="schublade" id="drawer-${i}">
                <div class="schublade-header" onclick="toggleDrawer(${i})"><span>SEKTOR ${i+1}: ${t}</span><span>▼</span></div>
                <div class="schublade-content">
                    <textarea class="schublade-textarea" placeholder="Deine Notizen..."></textarea>
                    <button style="margin-top:10px; background:#00ff00; padding:5px 15px; border:none; cursor:pointer;" onclick="alert('Gesichert')">DOKUMENT SICHERN</button>
                </div>
            </div>`;
    });

    const vGrid = document.getElementById('v-grid');
    for(let i=1; i<=8; i++) vGrid.innerHTML += `<div class="video-slot">SLOT ${i} ${i==1?'(DU)':''}</div>`;
    for(let i=1; i<=4; i++) document.getElementById('dot-holder').innerHTML += `<div id="dot${i}" class="dot ${i==1?'active':''}"></div>`;

    // 1. REIHENFOLGE-LOGIK
    function checkAccess(id) {
        if (id === 0 || geleseneThemen.has(id - 1) || isQualifiziert) {
            tId = id; showInfo();
        } else {
            alert("Bitte schalte erst Sektor " + id + " frei (der Reihe nach)!");
        }
    }

    function showInfo() {
        ebene = 2; geleseneThemen.add(tId);
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('page-skelett').style.display = 'flex';
        document.getElementById('info-titel').innerText = themen[tId];
        document.getElementById('main-text').innerText = "Inhalt für " + themen[tId] + "...";
        startRotation();
        updateUI();
    }

    // 2. WERBE-ROTATION
    function startRotation() {
        const bg = document.getElementById('werbe-bg');
        clearInterval(werbeIntervall);
        const rotate = () => {
            bg.classList.remove('bild-aktiv');
            setTimeout(() => {
                bg.style.backgroundImage = `url('https://picsum.photos/seed/${Math.random()}/1200/600')`;
                bg.classList.add('bild-aktiv');
            }, 100);
        };
        rotate();
        werbeIntervall = setInterval(rotate, 5000);
    }

    // 3. SCHUBLADEN & SCROLL FIX
    function toggleDrawer(id) {
        const drawer = document.getElementById(`drawer-${id}`);
        const wasOpen = drawer.classList.contains('open');
        document.querySelectorAll('.schublade').forEach(d => d.classList.remove('open'));
        if(!wasOpen) {
            drawer.classList.add('open');
            setTimeout(() => drawer.scrollIntoView({ behavior: 'smooth', block: 'center' }), 300);
        }
    }

    function registriereSenden() {
        const inp = document.getElementById('chat-input');
        if(!inp.value.trim()) return;
        document.getElementById('chat-box').innerHTML += `<div><strong>Du:</strong> ${inp.value}</div>`;
        interaktionsZaehler[tId]++;
        inp.value = "";
        updateUI();
    }

    function updateUI() {
        document.getElementById('chat-area').style.display = (ebene === 3) ? 'flex' : 'none';
        document.getElementById('drawer-ebene4').style.display = (ebene === 4) ? 'flex' : 'none';
        document.getElementById('main-text').style.display = (ebene === 2) ? 'block' : 'none';
        
        document.getElementById('btn-next').style.visibility = (isVerifiziert && ebene === 2 && tId < 19) ? 'visible' : 'hidden';

        // Signal-Aktivierung (Nur wenn Sektor durchgearbeitet oder Admin)
        const alleBesucht = geleseneThemen.size >= 20;
        document.getElementById('sig-r4').classList.toggle('signal-aktiv', ebene === 2 && alleBesucht);
        document.getElementById('sig-l4').classList.toggle('signal-aktiv', ebene === 3 && interaktionsZaehler[tId] >= 20);

        // Der grüne Button in Ebene 4
        document.getElementById('video-btn').style.opacity = (ebene === 4) ? "1" : "0.5";

        for(let i=1; i<=4; i++) {
            const d = document.getElementById('dot'+i);
            if(d) d.classList.toggle('active', i === ebene);
        }
        updateNumColors();
    }

    function portalZuEbene3() { if(document.getElementById('sig-r4').classList.contains('signal-aktiv')) { ebene = 3; updateUI(); } }
    function portalZuEbene4() { if(document.getElementById('sig-l4').classList.contains('signal-aktiv')) { ebene = 4; updateUI(); } }
    function showDashboard() { ebene = 1; clearInterval(werbeIntervall); document.getElementById('page-skelett').style.display = 'none'; document.getElementById('dashboard').style.display = 'flex'; }
    function nextPage() { if(tId < 19) { tId++; showInfo(); } }

    function updateNumColors() {
        themen.forEach((_, i) => {
            const n = document.getElementById(`num-${i}`);
            if(interaktionsZaehler[i] >= 20) n.className = "num num-fertig";
            else if(geleseneThemen.has(i)) n.className = "num num-gelesen";
        });
    }

    function adminUnlock() {
        isVerifiziert = true; isQualifiziert = true;
        themen.forEach((_, i) => geleseneThemen.add(i));
        updateUI(); alert("Admin Mode Aktiv: Alles offen!");
    }
</script>
</body>
</html
